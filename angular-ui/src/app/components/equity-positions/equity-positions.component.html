<div class="equity-positions-container">
  <!-- Simple Header -->
  <div class="header">
    <h1>Equity Positions Management</h1>
    <div class="status">Backend: {{ backendStatus }}</div>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="loadSampleData()" [disabled]="isLoading">Load Sample Data</button>
      <button mat-raised-button color="warn" (click)="clearAll()" [disabled]="isLoading">Clear All</button>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <!-- Loading Spinner -->
  <div class="loading" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Processing...</p>
  </div>

  <div class="main-content">
    <!-- Positions Display -->
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title>Current Positions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="positions" *ngIf="positions.length > 0; else noPositions">
          <div class="position" *ngFor="let position of positions">
            <span class="security">{{ position.securityCode }}</span>
            <span class="quantity" [class.positive]="position.quantity > 0" [class.negative]="position.quantity < 0">
              {{ formatPosition(position.quantity) }}
            </span>
          </div>
        </div>
        <ng-template #noPositions>
          <p>No positions available.</p>
        </ng-template>
      </mat-card-content>
    </mat-card>

    <!-- Single Transaction Form -->
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title>Add Single Transaction</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form class="form" (ngSubmit)="addTransaction()">
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Transaction ID</mat-label>
              <input matInput type="number" [(ngModel)]="newTransaction.transactionId" name="transactionId" required>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Trade ID</mat-label>
              <input matInput type="number" [(ngModel)]="newTransaction.tradeId" name="tradeId" required>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Version</mat-label>
              <input matInput type="number" [(ngModel)]="newTransaction.version" name="version" required>
            </mat-form-field>
          </div>
          
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Security Code</mat-label>
              <input matInput [(ngModel)]="newTransaction.securityCode" name="securityCode" required>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Quantity</mat-label>
              <input matInput type="number" [(ngModel)]="newTransaction.quantity" name="quantity" required>
            </mat-form-field>
          </div>
          
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Action</mat-label>
              <mat-select [(ngModel)]="newTransaction.action" name="action" required>
                <mat-option value="INSERT">INSERT</mat-option>
                <mat-option value="UPDATE">UPDATE</mat-option>
                <mat-option value="CANCEL">CANCEL</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Side</mat-label>
              <mat-select [(ngModel)]="newTransaction.side" name="side" required>
                <mat-option value="BUY">Buy</mat-option>
                <mat-option value="SELL">Sell</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          
          <button mat-raised-button color="primary" type="submit">Add Transaction</button>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Bulk Transactions -->
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title>Bulk Transactions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Transactions (CSV format)</mat-label>
          <textarea 
            matInput
            [(ngModel)]="bulkTransactionsText" 
            name="bulkTransactions"
            placeholder="1,1,1,REL,50,INSERT,BUY&#10;2,2,1,ITC,40,INSERT,SELL"
            rows="6"
          ></textarea>
        </mat-form-field>
        <button mat-raised-button color="accent" (click)="processBulkTransactions()">Process Bulk Transactions</button>
      </mat-card-content>
    </mat-card>

    <!-- Transactions History -->
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title>Transaction History</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="transactions" *ngIf="transactions.length > 0; else noTransactions" class="table">
          <ng-container matColumnDef="transactionId">
            <th mat-header-cell *matHeaderCellDef>Transaction ID</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.transactionId }}</td>
          </ng-container>

          <ng-container matColumnDef="tradeId">
            <th mat-header-cell *matHeaderCellDef>Trade ID</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.tradeId }}</td>
          </ng-container>

          <ng-container matColumnDef="version">
            <th mat-header-cell *matHeaderCellDef>Version</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.version }}</td>
          </ng-container>

          <ng-container matColumnDef="securityCode">
            <th mat-header-cell *matHeaderCellDef>Security Code</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.securityCode }}</td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Quantity</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.quantity }}</td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Action</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.action }}</td>
          </ng-container>

          <ng-container matColumnDef="side">
            <th mat-header-cell *matHeaderCellDef>Side</th>
            <td mat-cell *matCellDef="let transaction">{{ transaction.side === 'BUY' ? 'Buy' : 'Sell' }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <ng-template #noTransactions>
          <p>No transactions available.</p>
        </ng-template>
      </mat-card-content>
    </mat-card>
  </div>
</div> 